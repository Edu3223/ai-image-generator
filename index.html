<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator - Generador de Imágenes con IA</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="Genera imágenes increíbles con IA. Funciona online y offline.">
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AI Image Generator">
    <link rel="apple-touch-icon" href="assets/icons/icon-192x192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16x16.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>
<body>
    <!-- Pantalla de carga -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>AI Image Generator</h2>
            <p>Cargando aplicación...</p>
        </div>
    </div>

    <!-- Pantalla de selección de modo -->
    <div id="mode-selection" class="mode-selection hidden">
        <div class="mode-container">
            <h1>AI Image Generator</h1>
            <p>Elige cómo quieres usar la aplicación</p>
            
            <div class="mode-buttons">
                <button id="online-mode-btn" class="mode-btn online">
                    <div class="mode-icon">🌐</div>
                    <h3>Modo Online</h3>
                    <p>Sincronización en la nube, más modelos de IA</p>
                </button>
                
                <button id="offline-mode-btn" class="mode-btn offline">
                    <div class="mode-icon">📱</div>
                    <h3>Modo Offline</h3>
                    <p>Funciona sin internet, datos locales</p>
                </button>
            </div>
        </div>
    </div>

    <!-- Pantalla de autenticación -->
    <div id="auth-screen" class="auth-screen hidden">
        <div class="auth-container">
            <h2 id="auth-title">Iniciar Sesión</h2>
            
            <!-- Autenticación Online -->
            <div id="online-auth" class="auth-form hidden">
                <input type="email" id="email" placeholder="Correo electrónico" required>
                <input type="password" id="password" placeholder="Contraseña" required>
                
                <button id="login-btn" class="auth-btn primary">Iniciar Sesión</button>
                <button id="register-btn" class="auth-btn secondary">Registrarse</button>
                <button id="google-auth-btn" class="auth-btn google">
                    <span>🔍</span> Continuar con Google
                </button>
                
                <p class="auth-switch">
                    ¿No tienes cuenta? <a href="#" id="switch-to-register">Regístrate aquí</a>
                </p>
            </div>
            
            <!-- Autenticación Offline -->
            <div id="offline-auth" class="auth-form hidden">
                <input type="text" id="username" placeholder="Nombre de usuario" required>
                <input type="password" id="pin" placeholder="PIN (4-6 dígitos)" required maxlength="6">
                
                <button id="offline-login-btn" class="auth-btn primary">Acceder</button>
                <button id="offline-register-btn" class="auth-btn secondary">Crear Usuario</button>
            </div>
            
            <button id="back-to-mode" class="back-btn">← Volver</button>
        </div>
    </div>

    <!-- Aplicación principal -->
    <div id="main-app" class="main-app hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <button id="menu-toggle" class="menu-toggle">☰</button>
                <h1>AI Image Generator</h1>
            </div>
            
            <div class="header-right">
                <span id="mode-indicator" class="mode-indicator"></span>
                <button id="user-menu" class="user-menu">
                    <span id="user-name">Usuario</span>
                    <span class="user-avatar">👤</span>
                </button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-content">
                <div class="user-info">
                    <div class="user-avatar-large">👤</div>
                    <h3 id="sidebar-user-name">Usuario</h3>
                    <p id="sidebar-mode">Modo Online</p>
                </div>
                
                <nav class="sidebar-nav">
                    <button class="nav-item active" data-section="generate">
                        <span class="nav-icon">✨</span>
                        Generar Imagen
                    </button>
                    
                    <button class="nav-item" data-section="gallery">
                        <span class="nav-icon">🖼️</span>
                        Galería
                    </button>
                    
                    <div class="nav-section">
                        <h4>Carpetas</h4>
                        <div id="folders-list">
                            <button class="nav-item folder" data-folder="familia">
                                <span class="nav-icon">👨‍👩‍👧‍👦</span>
                                Familia
                            </button>
                            <button class="nav-item folder" data-folder="trabajo">
                                <span class="nav-icon">💼</span>
                                Trabajo
                            </button>
                            <button class="nav-item folder" data-folder="amigos">
                                <span class="nav-icon">👥</span>
                                Amigos
                            </button>
                        </div>
                        <button id="add-folder" class="nav-item add-folder">
                            <span class="nav-icon">➕</span>
                            Agregar Carpeta
                        </button>
                    </div>
                </nav>
                
                <div class="sidebar-footer">
                    <button id="switch-mode" class="switch-mode-btn">
                        <span class="nav-icon">🔄</span>
                        Cambiar Modo
                    </button>
                    <button id="logout" class="logout-btn">
                        <span class="nav-icon">🚪</span>
                        Cerrar Sesión
                    </button>
                </div>
            </div>
        </aside>

        <!-- Contenido principal -->
        <main id="main-content" class="main-content">
            <!-- Sección de generación -->
            <section id="generate-section" class="content-section active">
                <div class="generate-container">
                    <h2>Generar Nueva Imagen</h2>
                    
                    <div class="generate-form">
                        <div class="upload-area" id="upload-area">
                            <div class="upload-content">
                                <div class="upload-icon">📷</div>
                                <p>Arrastra una imagen aquí o haz clic para seleccionar</p>
                                <input type="file" id="image-input" accept="image/*" hidden>
                            </div>
                            <div id="image-preview" class="image-preview hidden">
                                <img id="preview-img" src="" alt="Vista previa">
                                <button id="remove-image" class="remove-btn">✕</button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="description">Descripción de la imagen:</label>
                            <textarea id="description" placeholder="Ej: gato con alas volando en el cielo" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="folder-select">Guardar en carpeta:</label>
                            <select id="folder-select">
                                <option value="">Galería principal</option>
                                <option value="familia">Familia</option>
                                <option value="trabajo">Trabajo</option>
                                <option value="amigos">Amigos</option>
                            </select>
                        </div>
                        
                        <div class="generate-options">
                            <div class="option-group">
                                <label>Número de imágenes:</label>
                                <select id="num-images">
                                    <option value="1">1 imagen</option>
                                    <option value="2" selected>2 imágenes</option>
                                    <option value="4">4 imágenes</option>
                                </select>
                            </div>
                            
                            <div class="option-group">
                                <label>Estilo:</label>
                                <select id="style-select">
                                    <option value="realistic">Realista</option>
                                    <option value="artistic">Artístico</option>
                                    <option value="cartoon">Caricatura</option>
                                    <option value="anime">Anime</option>
                                </select>
                            </div>
                        </div>
                        
                        <button id="generate-btn" class="generate-btn">
                            <span class="btn-text">Generar Imágenes</span>
                            <span class="btn-loading hidden">Generando...</span>
                        </button>
                    </div>
                    
                    <!-- Resultados de generación -->
                    <div id="generation-results" class="generation-results hidden">
                        <h3>Imágenes Generadas</h3>
                        <div id="results-grid" class="results-grid"></div>
                    </div>
                </div>
            </section>

            <!-- Sección de galería -->
            <section id="gallery-section" class="content-section">
                <div class="gallery-container">
                    <div class="gallery-header">
                        <h2 id="gallery-title">Galería</h2>
                        <div class="gallery-controls">
                            <button id="select-all" class="control-btn">Seleccionar Todo</button>
                            <button id="delete-selected" class="control-btn danger" disabled>Eliminar</button>
                        </div>
                    </div>
                    
                    <div id="gallery-grid" class="gallery-grid">
                        <!-- Las imágenes se cargarán dinámicamente -->
                    </div>
                    
                    <div id="empty-gallery" class="empty-state">
                        <div class="empty-icon">🖼️</div>
                        <h3>No hay imágenes</h3>
                        <p>Genera tu primera imagen para comenzar</p>
                        <button class="empty-action" data-section="generate">Generar Imagen</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de imagen completa -->
    <div id="image-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close">✕</button>
            <img id="modal-image" src="" alt="">
            <div class="modal-actions">
                <button id="download-image" class="modal-btn">Descargar</button>
                <button id="delete-image" class="modal-btn danger">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Modal de nueva carpeta -->
    <div id="folder-modal" class="modal hidden">
        <div class="modal-content small">
            <h3>Nueva Carpeta</h3>
            <input type="text" id="folder-name" placeholder="Nombre de la carpeta" maxlength="20">
            <div class="modal-actions">
                <button id="create-folder" class="modal-btn">Crear</button>
                <button id="cancel-folder" class="modal-btn secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Overlay para sidebar móvil -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ai-generator.js"></script>
    <script src="js/gallery.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registrado: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW falló: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>

